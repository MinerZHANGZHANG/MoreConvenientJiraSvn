<Window
    x:Class="MoreConvenientJiraSvn.App.Views.Windows.IssueAIAnalysisWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:control="clr-namespace:MoreConvenientJiraSvn.App.Views.Controls"
    xmlns:convert="clr-namespace:MoreConvenientJiraSvn.App.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:MoreConvenientJiraSvn.App.Views.Windows"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="clr-namespace:MoreConvenientJiraSvn.Core.Models;assembly=MoreConvenientJiraSvn.Core"
    xmlns:style="clr-namespace:MoreConvenientJiraSvn.App.Styles"
    xmlns:viewModel="clr-namespace:MoreConvenientJiraSvn.App.ViewModels"
    Title="AIIssueAnalysisWindow"
    Width="1280"
    Height="720"
    d:DataContext="{d:DesignInstance Type=viewModel:IssueAIAnalysisViewModel}"
    Style="{StaticResource MaterialDesignWindow}"
    mc:Ignorable="d">

    <materialDesign:DialogHost>
        <materialDesign:DrawerHost>
            <!--  Left Drawer content  -->
            <materialDesign:DrawerHost.LeftDrawerContent>
                <ScrollViewer Width="320" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10" Orientation="Vertical">
                        <Border
                            Margin="0,0,0,10"
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="4">
                            <Expander Header="模型配置" IsExpanded="True">
                                <StackPanel Margin="8" Orientation="Vertical">
                                    <!--  Model API Address  -->
                                    <TextBox materialDesign:HintAssist.Hint="模型接口地址" Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                                    <!--  ApiKey  -->
                                    <TextBox
                                        Margin="0,5"
                                        materialDesign:HintAssist.Hint="ApiKey"
                                        Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                                    <!--  Model Selection: Editable ComboBox  -->
                                    <ComboBox
                                        Margin="0,5"
                                        materialDesign:HintAssist.Hint="选择或输入模型"
                                        IsEditable="True"
                                        Style="{StaticResource MaterialDesignComboBox}" />
                                    <!--  Enable streaming conversation (if supported by model)  -->
                                    <ToggleButton
                                        Margin="0,5"
                                        Content="启用流式对话(需模型支持)"
                                        Style="{StaticResource MaterialDesignChoiceChipOutlineRadioButton}" />
                                    <!--  Enable multimodal input (if supported by model)  -->
                                    <ToggleButton
                                        Margin="0,5"
                                        Content="启用多模态输入(需模型支持)"
                                        Style="{StaticResource MaterialDesignChoiceChipOutlineRadioButton}" />
                                    <!--  Local folder selection button with icon  -->
                                    <Button Margin="0,5" Style="{StaticResource MaterialDesignFlatButton}">
                                        <StackPanel Orientation="Horizontal">
                                            <materialDesign:PackIcon
                                                Width="20"
                                                Height="20"
                                                Margin="0,0,5,0"
                                                Kind="Folder" />
                                            <TextBlock VerticalAlignment="Center" Text="选择模型默认可访问的文件夹" />
                                        </StackPanel>
                                    </Button>
                                    <!--  Folder list  -->
                                    <DataGrid
                                        Height="150"
                                        Margin="0,5"
                                        AutoGenerateColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Binding="{Binding FolderName}" Header="文件夹名称" />
                                            <DataGridTemplateColumn Header="操作">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Orientation="Horizontal">
                                                            <Button Padding="4" Style="{StaticResource MaterialDesignFlatButton}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <materialDesign:PackIcon
                                                                        Width="16"
                                                                        Height="16"
                                                                        Margin="0,0,3,0"
                                                                        Kind="FolderOpen" />
                                                                    <TextBlock VerticalAlignment="Center" Text="打开" />
                                                                </StackPanel>
                                                            </Button>
                                                            <Button Padding="4" Style="{StaticResource MaterialDesignFlatButton}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <materialDesign:PackIcon
                                                                        Width="16"
                                                                        Height="16"
                                                                        Margin="0,0,3,0"
                                                                        Kind="Delete" />
                                                                    <TextBlock VerticalAlignment="Center" Text="移除" />
                                                                </StackPanel>
                                                            </Button>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Expander>
                        </Border>
                        <Border
                            BorderBrush="LightGray"
                            BorderThickness="1"
                            CornerRadius="4">
                            <!--  Prompt setting  -->
                            <Expander Header="提示词配置" IsExpanded="True">
                                <StackPanel Margin="10" Orientation="Vertical">
                                    <TextBox
                                        Height="100"
                                        Margin="0,5"
                                        materialDesign:HintAssist.Hint="填写提示词"
                                        AcceptsReturn="True"
                                        Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                        VerticalScrollBarVisibility="Auto" />
                                    <ComboBox
                                        Margin="0,5"
                                        materialDesign:HintAssist.Hint="预设提示词"
                                        Style="{StaticResource MaterialDesignComboBox}" />
                                </StackPanel>
                            </Expander>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </materialDesign:DrawerHost.LeftDrawerContent>

            <!--  Main content  -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="3*" />
                </Grid.ColumnDefinitions>
                <!--  Left Side: File Information and History Data  -->
                <TabControl Grid.Column="0" Margin="5">
                    <!--  Current Session Tab  -->
                    <TabItem Header="当前会话">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <!--  Top fixed: Button to add files accessible by the model  -->
                            <Button
                                Grid.Row="0"
                                Margin="5"
                                Style="{StaticResource MaterialDesignFlatButton}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon
                                        Width="20"
                                        Height="20"
                                        Margin="0,0,5,0"
                                        Kind="FileOutline" />
                                    <TextBlock VerticalAlignment="Center" Text="添加模型可读取的文件" />
                                </StackPanel>
                            </Button>
                            <!--  Middle scrollable DataGrid  -->
                            <DataGrid
                                Grid.Row="1"
                                Margin="5"
                                AutoGenerateColumns="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding FileIndex}" Header="文件序号" />
                                    <DataGridTextColumn Binding="{Binding FileName}" Header="文件名称" />
                                    <DataGridTextColumn Binding="{Binding FileType}" Header="文件类型" />
                                    <DataGridTemplateColumn Header="操作">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Padding="2" Style="{StaticResource MaterialDesignFlatButton}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon
                                                                Width="16"
                                                                Height="16"
                                                                Margin="0,0,3,0"
                                                                Kind="FolderOpen" />
                                                            <TextBlock VerticalAlignment="Center" Text="打开" />
                                                        </StackPanel>
                                                    </Button>
                                                    <Button Padding="2" Style="{StaticResource MaterialDesignFlatButton}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <materialDesign:PackIcon
                                                                Width="16"
                                                                Height="16"
                                                                Margin="0,0,3,0"
                                                                Kind="Delete" />
                                                            <TextBlock VerticalAlignment="Center" Text="移除" />
                                                        </StackPanel>
                                                    </Button>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <!--  Bottom: Jira Issue Key input and load button arranged in grid layout  -->
                            <Grid Grid.Row="2" Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" Style="{StaticResource MaterialDesignFlatButton}">
                                    <materialDesign:PackIcon
                                        Width="20"
                                        Height="20"
                                        Margin="0,0,5,0"
                                        Kind="QuestionMark" />
                                </Button>
                                <TextBox
                                    Grid.Column="1"
                                    Margin="0,0,5,0"
                                    materialDesign:HintAssist.Hint="输入Jira编号载入默认文件"
                                    Style="{StaticResource MaterialDesignFloatingHintTextBox}" />
                                <Button Grid.Column="2" Style="{StaticResource MaterialDesignFlatButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon
                                            Width="20"
                                            Height="20"
                                            Margin="0,0,5,0"
                                            Kind="Refresh" />
                                        <TextBlock VerticalAlignment="Center" Text="加载" />
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Grid>
                    </TabItem>
                    <!--  History Data Tab  -->
                    <TabItem Header="历史数据">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <DataGrid
                                Grid.Row="0"
                                Margin="5"
                                AutoGenerateColumns="False">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Binding="{Binding ModelName}" Header="模型名称" />
                                    <DataGridTextColumn Binding="{Binding Title}" Header="对话标题" />
                                    <DataGridTextColumn Binding="{Binding LastTime}" Header="最后对话时间" />
                                    <DataGridTemplateColumn Header="操作">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Padding="2" Style="{StaticResource MaterialDesignFlatButton}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon
                                                            Width="16"
                                                            Height="16"
                                                            Margin="0,0,3,0"
                                                            Kind="SwapCalls" />
                                                        <TextBlock VerticalAlignment="Center" Text="切换" />
                                                    </StackPanel>
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <!--  Bottom: Date pickers and query button  -->
                            <Grid Grid.Row="1" Margin="5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <DatePicker
                                    Grid.Column="0"
                                    Width="120"
                                    Margin="0,0,5,0"
                                    materialDesign:HintAssist.Hint="开始日期" />
                                <DatePicker
                                    Grid.Column="1"
                                    Width="120"
                                    Margin="0,0,5,0"
                                    materialDesign:HintAssist.Hint="结束日期" />
                                <Button Grid.Column="2" Style="{StaticResource MaterialDesignFlatButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon
                                            Width="20"
                                            Height="20"
                                            Margin="0,0,5,0"
                                            Kind="Magnify" />
                                        <TextBlock VerticalAlignment="Center" Text="查询" />
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Grid>
                    </TabItem>
                </TabControl>
                <!--  Right Side: Chat Interface  -->
                <Grid Grid.Column="1" Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <!--  Conversation display area, supports Markdown (using MdXaml conversion)  -->
                    <FlowDocumentScrollViewer
                        Grid.Row="0"
                        Margin="5"
                        VerticalScrollBarVisibility="Auto">
                        <FlowDocument>
                            <!--  Content displayed after Markdown conversion  -->
                            <Paragraph>
                                对话显示区…
                            </Paragraph>
                        </FlowDocument>
                    </FlowDocumentScrollViewer>
                    <!--  Message input area  -->
                    <Grid Grid.Row="1" Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <!--  Settings button with icon  -->
                        <Button
                            Grid.Column="0"
                            Margin="0,0,5,0"
                            Command="{x:Static materialDesign:DrawerHost.OpenDrawerCommand}"
                            CommandParameter="{x:Static Dock.Left}"
                            Style="{StaticResource MaterialDesignFlatButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon
                                    Width="20"
                                    Height="20"
                                    Margin="0,0,5,0"
                                    Kind="Settings" />
                                <TextBlock VerticalAlignment="Center" Text="设置" />
                            </StackPanel>
                        </Button>
                        <!--  Textbox fills remaining space  -->
                        <TextBox
                            Grid.Column="1"
                            Height="60"
                            Margin="0,0,5,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Center"
                            materialDesign:HintAssist.Hint="请输入消息"
                            AcceptsReturn="True"
                            Style="{StaticResource MaterialDesignOutlinedTextBox}"
                            VerticalScrollBarVisibility="Auto" />
                        <!--  Send button with icon  -->
                        <Button Grid.Column="2" Style="{StaticResource MaterialDesignRaisedButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon
                                    Width="20"
                                    Height="20"
                                    Margin="0,0,5,0"
                                    Kind="Send" />
                                <TextBlock VerticalAlignment="Center" Text="发送" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </Grid>
            </Grid>
        </materialDesign:DrawerHost>
    </materialDesign:DialogHost>
</Window>
